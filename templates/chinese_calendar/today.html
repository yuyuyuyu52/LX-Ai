{% extends 'base.html' %}

{% block title %}今日运势 - 灵汐命理平台{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-10 mx-auto">
            <div class="text-center mb-5">
                <h1 class="zen-section-title">
                    <i class="fas fa-calendar-day zen-icon"></i> 今日灵汐
                </h1>
                <p class="zen-section-subtitle">{{ calendar_day.date|date:'Y年m月d日' }} {{ calendar_day.date|date:'l' }}</p>
                <div class="zen-card d-inline-block">
                    <div class="zen-card-body py-2 px-4">
                        <i class="fas fa-moon me-2 zen-text-decoration"></i> 
                        <span class="zen-text-primary">农历：{{ calendar_day.lunar_year }}{{ calendar_day.lunar_month }}{{ calendar_day.lunar_day }}</span>
                    </div>
                </div>
            </div>            <!-- 今日概况 -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="zen-card h-100">
                        <div class="zen-card-header text-center">
                            <h5 class="zen-subtitle"><i class="fas fa-yin-yang zen-icon"></i> 天干地支</h5>
                        </div>
                        <div class="zen-card-body text-center">
                            <div class="display-6 fw-bold zen-text-accent mb-3">
                                {{ calendar_day.tiangan }}{{ calendar_day.dizhi }}
                            </div>
                            <p class="zen-text-secondary">今日干支组合</p>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="zen-card h-100">
                        <div class="zen-card-header text-center">
                            <h5 class="zen-subtitle"><i class="fas fa-star zen-icon"></i> 星座运势</h5>
                        </div>
                        <div class="zen-card-body text-center">
                            <div class="display-6 fw-bold zen-text-primary mb-3">
                                {{ calendar_day.constellation }}
                            </div>
                            <p class="zen-text-secondary">今日星座</p>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="zen-card h-100">                        <div class="zen-card-header text-center">
                            <h5 class="zen-subtitle"><i class="fas fa-fire zen-icon"></i> 五行属性</h5>
                        </div>
                        <div class="zen-card-body text-center">
                            <div class="display-6 fw-bold zen-text-decoration mb-3">
                                木
                            </div>
                            <p class="zen-text-secondary">今日主旺</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 宜忌事项 -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="zen-card h-100">
                        <div class="zen-card-header">
                            <h5 class="zen-subtitle zen-text-accent"><i class="fas fa-thumbs-up zen-icon"></i> 今日宜做</h5>
                        </div>
                        <div class="zen-card-body">
                            <div class="d-flex flex-wrap gap-2">
                                {% for activity in calendar_day.suitable_activities|split:'，' %}
                                    {% if activity %}
                                        <span class="zen-lucky-item">
                                            <i class="fas fa-check-circle me-1"></i>{{ activity }}
                                        </span>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <div class="mt-3">
                                <small class="zen-text-secondary">
                                    <i class="fas fa-lightbulb"></i> 
                                    今日适合进行以上活动，有利于事业和运势发展
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="zen-card h-100">
                        <div class="zen-card-header">
                            <h5 class="zen-subtitle zen-text-secondary"><i class="fas fa-thumbs-down zen-icon"></i> 今日忌做</h5>
                        </div>
                        <div class="zen-card-body">
                            <div class="d-flex flex-wrap gap-2">
                                {% for activity in calendar_day.avoid_activities|split:'，' %}
                                    {% if activity %}                                        <span class="zen-lucky-item" style="background: rgba(168, 158, 146, 0.2); border-color: var(--zen-secondary);">
                                            <i class="fas fa-times-circle me-1"></i>{{ activity }}
                                        </span>
                                    {% endif %}
                                {% endfor %}
                            </div>
                            <div class="mt-3">
                                <small class="zen-text-secondary">
                                    <i class="fas fa-exclamation-triangle"></i> 
                                    今日不宜进行以上活动，以免影响运势
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 时辰运势 -->
            <div class="zen-card mb-4">
                <div class="zen-card-header">
                    <h5 class="zen-subtitle"><i class="fas fa-clock zen-icon"></i> 十二时辰运势</h5>
                </div>
                <div class="zen-card-body">
                    <div class="row g-3">
                        <div class="col-md-3 col-sm-6">
                            <div class="zen-time-fortune-card zen-fortune-good">
                                <div class="fw-bold zen-text-primary">子时</div>
                                <div class="small zen-text-secondary">23:00-01:00</div>
                                <div class="zen-badge zen-badge-accent mt-1">吉</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="zen-time-fortune-card zen-fortune-normal">
                                <div class="fw-bold zen-text-primary">丑时</div>
                                <div class="small zen-text-secondary">01:00-03:00</div>
                                <div class="zen-badge zen-badge-decoration mt-1">平</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="zen-time-fortune-card zen-fortune-good">
                                <div class="fw-bold zen-text-primary">寅时</div>
                                <div class="small zen-text-secondary">03:00-05:00</div>
                                <div class="zen-badge zen-badge-accent mt-1">吉</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="zen-time-fortune-card zen-fortune-bad">
                                <div class="fw-bold zen-text-primary">卯时</div>
                                <div class="small zen-text-secondary">05:00-07:00</div>
                                <div class="zen-badge zen-badge-secondary mt-1">凶</div>
                            </div>
                        </div>                        <div class="col-md-3 col-sm-6">
                            <div class="zen-time-fortune-card zen-fortune-good">
                                <div class="fw-bold zen-text-primary">辰时</div>
                                <div class="small zen-text-secondary">07:00-09:00</div>
                                <div class="zen-badge zen-badge-accent mt-1">吉</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="zen-time-fortune-card zen-fortune-normal">
                                <div class="fw-bold zen-text-primary">巳时</div>
                                <div class="small zen-text-secondary">09:00-11:00</div>
                                <div class="zen-badge zen-badge-decoration mt-1">平</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="zen-time-fortune-card zen-fortune-good">
                                <div class="fw-bold zen-text-primary">午时</div>
                                <div class="small zen-text-secondary">11:00-13:00</div>
                                <div class="zen-badge zen-badge-accent mt-1">吉</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="zen-time-fortune-card zen-fortune-bad">
                                <div class="fw-bold zen-text-primary">未时</div>
                                <div class="small zen-text-secondary">13:00-15:00</div>
                                <div class="zen-badge zen-badge-secondary mt-1">凶</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="zen-time-fortune-card zen-fortune-normal">
                                <div class="fw-bold zen-text-primary">申时</div>
                                <div class="small zen-text-secondary">15:00-17:00</div>
                                <div class="zen-badge zen-badge-decoration mt-1">平</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="zen-time-fortune-card zen-fortune-good">
                                <div class="fw-bold zen-text-primary">酉时</div>
                                <div class="small zen-text-secondary">17:00-19:00</div>
                                <div class="zen-badge zen-badge-accent mt-1">吉</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="zen-time-fortune-card zen-fortune-bad">
                                <div class="fw-bold zen-text-primary">戌时</div>
                                <div class="small zen-text-secondary">19:00-21:00</div>
                                <div class="zen-badge zen-badge-secondary mt-1">凶</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="zen-time-fortune-card zen-fortune-normal">
                                <div class="fw-bold zen-text-primary">亥时</div>
                                <div class="small zen-text-secondary">21:00-23:00</div>
                                <div class="zen-badge zen-badge-decoration mt-1">平</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>            <!-- 今日建议 -->
            <div class="zen-card mb-4">
                <div class="zen-card-header">
                    <h5 class="zen-subtitle"><i class="fas fa-lightbulb zen-icon"></i> 今日建议</h5>
                </div>
                <div class="zen-card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="zen-fortune-item mb-4">
                                <div class="zen-fortune-header">
                                    <i class="fas fa-heart zen-text-decoration"></i> 
                                    <span class="zen-fortune-title">情感运势</span>
                                </div>
                                <p class="zen-text-secondary mb-3">今日感情运势较好，单身者有机会遇到心仪的对象，已有伴侣的感情会更加稳定。建议多关心身边的人，表达真挚的情感。</p>
                            </div>
                            
                            <div class="zen-fortune-item">
                                <div class="zen-fortune-header">
                                    <i class="fas fa-briefcase zen-text-accent"></i> 
                                    <span class="zen-fortune-title">事业运势</span>
                                </div>
                                <p class="zen-text-secondary mb-3">工作方面会有新的机遇出现，适合制定新的计划和目标。与同事的合作会很顺利，有助于项目的推进。</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="zen-fortune-item mb-4">
                                <div class="zen-fortune-header">
                                    <i class="fas fa-coins zen-text-decoration"></i> 
                                    <span class="zen-fortune-title">财运分析</span>
                                </div>
                                <p class="zen-text-secondary mb-3">财运平稳，收入稳定。不宜进行高风险投资，可以考虑一些稳健的理财方式。购物方面要理性消费。</p>
                            </div>
                            
                            <div class="zen-fortune-item">
                                <div class="zen-fortune-header">
                                    <i class="fas fa-dumbbell zen-text-accent"></i> 
                                    <span class="zen-fortune-title">健康提醒</span>
                                </div>
                                <p class="zen-text-secondary mb-3">身体状况良好，精力充沛。建议保持规律的作息时间，适当运动，注意饮食均衡。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>            <!-- 操作按钮 -->
            <div class="text-center mb-4">
                <div class="zen-btn-group" role="group">
                    <a href="{% url 'chinese_calendar:calendar' %}" class="zen-btn zen-btn-outline">
                        <i class="fas fa-calendar-alt me-1"></i>查看其他日期
                    </a>
                    <button class="zen-btn zen-btn-outline" onclick="shareToday()">
                        <i class="fas fa-share me-1"></i>分享今日运势
                    </button>
                    <button class="zen-btn zen-btn-primary" onclick="saveToProfile()">
                        <i class="fas fa-bookmark me-1"></i>收藏到个人档案
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function shareToday() {
    if (navigator.share) {
        navigator.share({
            title: '灵汐命理平台 - 今日运势分享',
            text: '查看我的今日运势分析',
            url: window.location.href
        });
    } else {
        // 复制链接到剪贴板
        navigator.clipboard.writeText(window.location.href).then(() => {
            // 显示优雅的提示
            const notification = document.createElement('div');
            notification.className = 'zen-notification';
            notification.innerHTML = '<i class="fas fa-check-circle me-2"></i>链接已复制到剪贴板';
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        });
    }
}

function saveToProfile() {
    fetch('/core/api/save-calendar-reading/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            date: '{{ calendar_day.date|date:"Y-m-d" }}',
            type: 'today_fortune'
        })
    })
    .then(response => response.json())
    .then(data => {
        const notification = document.createElement('div');
        notification.className = 'zen-notification';
        
        if (data.success) {
            notification.innerHTML = '<i class="fas fa-check-circle me-2"></i>今日运势已保存到个人档案';
        } else {
            notification.innerHTML = '<i class="fas fa-exclamation-circle me-2"></i>保存失败，请稍后重试';
        }
        
        document.body.appendChild(notification);
        setTimeout(() => {
            notification.remove();
        }, 3000);
    })
    .catch(error => {
        console.error('Error:', error);
        const notification = document.createElement('div');
        notification.className = 'zen-notification';
        notification.innerHTML = '<i class="fas fa-exclamation-circle me-2"></i>保存失败，请稍后重试';
        document.body.appendChild(notification);
        setTimeout(() => {
            notification.remove();
        }, 3000);
    });
}
</script>
{% endblock %}
